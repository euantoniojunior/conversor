<script>
  function updateProgressBar(progress) {
    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = progress + '%';
    progressBar.textContent = progress + '%';
  }

  // Mostra os nomes dos arquivos selecionados
  document.getElementById('files').addEventListener('change', function () {
    const fileList = document.getElementById('file-list');
    fileList.innerHTML = ''; // Limpa lista anterior

    if (this.files.length === 0) {
      fileList.textContent = 'Nenhum arquivo selecionado.';
      return;
    }

    const ul = document.createElement('ul');
    ul.style.listStyleType = 'none';
    ul.style.paddingLeft = '0';

    Array.from(this.files).forEach(file => {
      const li = document.createElement('li');
      li.textContent = `üìÑ ${file.name}`;
      li.style.margin = '4px 0';
      ul.appendChild(li);
    });

    fileList.appendChild(ul);
  });

  // L√≥gica do formul√°rio
  document.getElementById('conversion-form').addEventListener('submit', function (event) {
    event.preventDefault();
    document.getElementById('progress-container').style.display = 'block';
    document.getElementById('loading-spinner').style.display = 'block';

    let progress = 0;
    const interval = setInterval(() => {
      progress += 10;
      updateProgressBar(progress);
      if (progress >= 100) {
        clearInterval(interval);
      }
    }, 500);

    const formData = new FormData(this);
    fetch('/', {
      method: 'POST',
      body: formData,
    })
      .then(response => response.blob())
      .then(blob => {
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'arquivos_mesclados.pdf';
        a.click();
        window.URL.revokeObjectURL(url);
        document.getElementById('progress-container').style.display = 'none';
        document.getElementById('loading-spinner').style.display = 'none';
        updateProgressBar(0);
      })
      .catch(error => {
        console.error('Erro durante a convers√£o:', error);
        alert('Ocorreu um erro durante a convers√£o.');
        document.getElementById('progress-container').style.display = 'none';
        document.getElementById('loading-spinner').style.display = 'none';
      });
  });
</script>
